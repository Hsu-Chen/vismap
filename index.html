<!DOCTYPE html>
<html lang="en">
	<head>
		<title></title>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, width=device-width, initial-scale=1, shrink-to-fit=no">
		<script   src="https://code.jquery.com/jquery-2.2.4.js"></script>
		<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="//d3js.org/topojson.v1.min.js"></script>
		<!-- Bootstrap core CSS -->
		<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		<!-- Custom styles for this template -->
		<link href="css/portfolio-item.css" rel="stylesheet">
		<style>
			/*HTML Vertical Lengend*/
			.country-name {
				margin: 0 !important;
			}

			.key-dot {
				display: inline-block;
				height: 10px;
				margin-right: .5em;
				width: 10px;
			}

			.legend {
				margin-left:20px;
			}

			.queens { background: #1F77B4;}
			.kings { background: #FF7F0E;}
			.bronx { background: #2CA02C;}
			
			.slidecontainer {
				width: 600px;
			}

			.slider {
				-webkit-appearance: none;
				width:100%;
				height: 25px;
				background: #51a7b2;
				outline: none;
				opacity: 0.7;
				-webkit-transition: .2s;
				transition: opacity .2s;
			}

			.slider:hover {
				opacity: 1;
			}

			.slider::-webkit-slider-thumb {
				-webkit-appearance: none;
				appearance: none;
				border-radius: 5px;
				width: 100px;
				height: 35px;
				background: #074c6d;
				cursor: pointer;
			}

			.slider::-moz-range-thumb {
				width: 25px;
				height: 25px;
				background: #074c6d;
				cursor: pointer;
			}
			.table {
				border-collapse: collapse;
			}

			.table, td, th {
				width:50px;
				height: 25px;
    			border: 0px solid black;
			}
			.dot {
				height: 25px;
				width: 25px;
				background-color: #bbb;
				border-radius: 50%;
				display: inline-block;
				padding:5px;
			}
		</style>

	</script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
			<div class="container">
				
				<!--div class="collapse navbar-collapse" id="navbarResponsive">
					<ul class="navbar-nav ml-auto">
						<li class="nav-item active">
							<a class="nav-link" href="#">Home
								<span class="sr-only">(current)</span>
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">About</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">Services</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">Contact</a>
						</li>
					</ul>
				</div-->
			</div>
		</nav>
		<!-- sideNav start -->
		<div id="mouseInf"></div>
		<div class="container">

			<!-- Portfolio Item Heading -->
			<h2 id="title1" class="my-4" style="display:block;font-weight:bold;">台灣<span id="demo"></span>年各縣市代理教師比例分布圖</h2>
			<h2 id="title2" style="display:none;font-weight:bold;">台灣106年各縣市代理教師薪資分布圖</h2>
			<!-- Portfolio Item Row -->
			<div class="row">
				<div class="col-md-8">
					<button id="button1" onclick="money()" class="w3-button w3-round-large" style="background-color: #074c6d;color: white;">106年代理教師薪資</button>
					<button id="button2" onclick="changemap(100)" class="w3-button w3-round-large" style="background-color: #074c6d;color:white;">100~105年代理教師比例</button>
					<svg id="taiwan" width="600px" height="600px" style="float:left;border:2px #074c6d solid;"></svg>
					<div class="slidecontainer" style="margin-top:615px;">
						<input type="range" min="100" max="105" value="100" class="slider" id="myRange">
					</div>
					<div style="margin-top:5%;">
						<h5 style="font-weight:bold;">製表／鄭緒辰、張登凱、翁愷均</h5>						
						<h5 style="font-weight:bold;">資料來源／《中小學兼任代課及代理教師聘任辦法》、各縣市相關之中小學兼任代課及代理教師聘任補充規定、中華民國教育統計</h5>
						<h5 style="font-weight:bold;">註：本表所指之代理教師，是為初任一學年期之代理教師，且無兼行政職。實際狀況可能因各校特殊需求、第二年後之聘期等因素而有所不同。</h5>
					</div>
				</div>
		  
				
					<div style="margin-top:20%;">
					<!--教師比例表格-->
					<table id="proportion" style="float:left;border:0px #009933 solid;display:block;" >
						<tr>
							<td colspan="2" style="font-weight:bold;">百分比(%)</td>
						</tr>
						<tr>
							<td><span class="dot" style="background-color:#a01a00;"></span></td>
							<td> &#62 14 </td>
						</tr>
						<tr>
							<td><span class="dot" style="background-color:#ff0b0b;"></span></td>
							<td> 12 ~ 14 </td>
						</tr>
						<tr>
							<td><span class="dot" style="background-color:#ff661a;"></span></td>
							<td> 10 ~ 12 </td>
						</tr>
						<tr>
							<td><span class="dot" style="background-color:#ffb533;"></span></td>
							<td> 8 ~ 10 </td>
						</tr>
						<tr>
							<td><span class="dot" style="background-color:#fcf344;"></span></td>
							<td> &#60 8 </td>
						</tr>
					</table>
					<!--教室薪資表格-->
					<table id="salary" style="float:left;border:0px #009933 solid;display:none;" >
						<tr>
							<td colspan="2" style="font-weight:bold;">聘期：<br>10個月又幾天</td>
						</tr>
						<tr>
							<td><span class="dot" style="background-color:#074c6d;"></span></td>
							<td> &#62 15天 </td>
						</tr>
						<tr>
							<td><span class="dot" style="background-color:#51a7b2;"></span></td>
							<td> 7~15天 </td>
						</tr>
						<tr>
							<td><span class="dot" style="background-color:#81dae6;"></span></td>
							<td width="100px"> &#60 7天 </td>
						</tr>
					</table>
					</div>

				
		  
			</div>
			<!-- /.row -->	  
		</div>
		<div class="row" style="margin-top:100px;">

				
		
		</div>
		<!-- Footer -->
		<footer class="py-5 bg-dark">
			<div class="container">
				<p class="m-0 text-center text-white"></p>
			</div>
			<!-- /.container -->
		</footer>
		
		
		<script type="text/javascript">
			var slider = document.getElementById("myRange");
			var output = document.getElementById("demo");
			var taiwan_img = document.getElementById("taiwan");
			var proportion_table = document.getElementById("proportion");
			var salary_table = document.getElementById("salary");
			var title1 = document.getElementById("title1");
			var title2 = document.getElementById("title2");
			var button1 = document.getElementById("button1");
			var button2 = document.getElementById("button2");

			output.innerHTML = slider.value;

			slider.oninput = function() {
				output.innerHTML = this.value;
				changemap(this.value);
			}
			
		</script>

		<script type="text/javascript">
			var number=getParameterByName('number');
			countyMap(100);
			if(number == 0){
				money();
			}
			/* 縮放、滑動 */
			/* 
				利用D3.js設計的Zoom Behavior，實現滑鼠滾輪滾動可地圖放大縮小效果，先宣告zoom行為，接著用call來呼叫zoom的行為。

				d3.behavior.zoom(): 宣告，這裡使用了幾個參數
				translate: 移動距離
				scaleExtent: 縮放最大值與最小值
				scale: 縮放大小比例
			*/
			var zoom = d3.behavior.zoom()
			.translate([0, 0])
			.scaleExtent([1, 10])
			.scale(1)
			.on("zoom", zoomed);
			function zoomed() {
				d3.select("svg").selectAll("path").attr("transform", "translate(" + d3.event.translate + ") scale(" + d3.event.scale + ")");
				d3.select("svg").selectAll("image").attr("transform", "translate(" + d3.event.translate + ") scale(" + d3.event.scale + ")");
			}

			function countyMap(year)
			{
				slider.style.display = "block";
				button1.style.backgroundColor = "#51a7b2";
				button2.style.backgroundColor = "#074c6d";

				/* 放置你的TopoJSON路徑 */
				d3.json("map/taiwan.json", function(error, map) {
					if (error) return console.error(error);
					/* 
						center: 設定地圖中心經緯度
						scale: 設定地圖大小
						translate: 設定地圖在svg上的中心位置
						on: 可以設定事件觸發，可設定參數有mousedown、mouseup、click、dblclick、mouseover、mouseout、mouseenter、mouseleave
						call(zoom): 呼叫zoom進行放大縮小滑動
					*/
						projection = d3.geo.mercator().center([121,23.5]).scale(6000).translate([330,340]);
						/* 將資料轉換成城SVG Path標籤的轉換函式 */
						path = d3.geo.path().projection(projection);
						/* 將資料中的特徵取出，map為JSON檔的資料，後方則是在JSON中，要取出特徵的部分 */
						features = topojson.feature(map, map.objects.County_WGS84).features;
						/* 利用D3c.js畫出svg */
						d3.select("svg").selectAll("path").data(features).enter().append("path").attr({
							d: path,
							fill: "#9EF89E",
							class: "area"
						});
						d3.select("svg").append('rect').attr('width', 60).attr('height', 30).attr('fill','none').attr('stroke','#074c6d').attr('x',220).attr('y',5);
						/* 上色 */

						d3.csv("taiwan_proportion.csv", function(data) {
						
							/* 將各縣市的數值(parameter)寫入features裡面，寫法範例，可自行更改 */
							for(item=features.length - 1; item >= 0; item-- ) { 
								var site = features[item].properties.County_ID;
								var parameter = data[year-100][site];
								if(typeof parameter == 'undefined'){
									features[item].properties.parameter = Math.floor((Math.random() * 100) + 1);
								}else{
									features[item].properties.parameter = parameter;
									//console.log(site);
								}	
							}
							/* 
								domain: 設定數值最低最高的範圍
								range: 設定最低最高的對應的顏色
							*/
							//var color = d3.scale.linear().domain([5,10,15]).range(["Yellow","orange","#ff1a1a"]);
							var color = ["#fcf344","#ffb533","#ff661a","#ff0b0b","#a01a00"];
							/* 利用D3c.js畫出svg，顏色依照features裡的parameter參數 */
							d3.select("svg").selectAll("path").data(features)
							.attr({
								d: path,
								fill: function(d) {
									if(d.properties.parameter < 8){return color[0];}
									else if(d.properties.parameter < 10){return color[1];}
									else if(d.properties.parameter < 12){return color[2];}
									else if(d.properties.parameter < 14){return color[3];}
									else{return color[4];}
									//return color(d.properties.parameter);
								},
								class: "area"
							}).on({
							/* 
								移入時，將選取到的地區(SVG PATH tag)加入css，計算滑鼠位置，將div#mouseIn座標設定到滑鼠位置
								移出時，將選取到的地區移除css，將div#mouseIn隱藏
							*/
								"mouseover": function(d){
									d3.select(this).classed("active", true);
									var x = d3.mouse(this)[0];
									var y = d3.mouse(this)[1];
									$('#mouseInf').css({ "top": event.clientY + "px", "left": event.clientX + "px" }).css("z-index","1").show("fast");
									$('#mouseInf').text(d.properties.C_Name+"\n"+d.properties.parameter+"%");
								},
								"mouseout":  function(){
									d3.select(this).classed("active", false);
									$('#mouseInf').hide();
								},
							})
						});
					});
					
			}

			function changemap(year){
				slider.style.display = "block";
				proportion_table.style.display = "block";
				salary_table.style.display = "none";
				title1.style.display = "block";
				title2.style.display = "none";
				button1.style.backgroundColor = "#51a7b2";
				button2.style.backgroundColor = "#074c6d";

				d3.csv("taiwan_proportion.csv", function(data) {
						
						/* 將各縣市的數值(parameter)寫入features裡面，寫法範例，可自行更改 */
						for(item=features.length - 1; item >= 0; item-- ) { 
							var site = features[item].properties.County_ID;
							var parameter = data[year-100][site];
							if(typeof parameter == 'undefined'){
								features[item].properties.parameter = Math.floor((Math.random() * 100) + 1);
							}else{
								features[item].properties.parameter = parameter;
								//console.log(site);
							}	
						}
						
						var color = ["#fcf344","#ffb533","#ff661a","#ff0b0b","#a01a00"];
						/* 利用D3c.js畫出svg，顏色依照features裡的parameter參數 */
						d3.select("svg").selectAll("path").data(features)
						.attr({
							d: path,
							fill: function(d) {
								if(d.properties.parameter < 8){return color[0];}
								else if(d.properties.parameter < 10){return color[1];}
								else if(d.properties.parameter < 12){return color[2];}
								else if(d.properties.parameter < 14){return color[3];}
								else{return color[4];}
							},
							class: "area"
						}).on({
							"mouseover": function(d){
								d3.select(this).classed("active", true);
								var x = d3.mouse(this)[0];
								var y = d3.mouse(this)[1];
								$('#mouseInf').css({ "top": event.clientY + "px", "left": event.clientX + "px" }).css("z-index","1").show("fast");
								$('#mouseInf').text(d.properties.C_Name+"\n"+d.properties.parameter+"%");
							},
							"mouseout":  function(){
								d3.select(this).classed("active", false);
								$('#mouseInf').hide();
							},
						})

					});
			}

			function money()
			{
				slider.style.display = "none";
				proportion_table.style.display = "none";
				salary_table.style.display = "block";
				title1.style.display = "none";
				title2.style.display = "block";
				button2.style.backgroundColor = "#51a7b2";
				button1.style.backgroundColor = "#074c6d";

				/* 放置你的TopoJSON路徑 */
				d3.json("map/taiwan.json", function(error, map) {
					if (error) return console.error(error);

						projection = d3.geo.mercator().center([121,23.5]).scale(6000).translate([330,340]);
						/* 將資料轉換成城SVG Path標籤的轉換函式 */
						path = d3.geo.path().projection(projection);
						/* 將資料中的特徵取出，map為JSON檔的資料，後方則是在JSON中，要取出特徵的部分 */
						features = topojson.feature(map, map.objects.County_WGS84).features;
						/* 利用D3c.js畫出svg */
						d3.select("svg").selectAll("path").data(features).enter().append("path").attr({
							d: path,
							fill: "#9EF89E",
							class: "area"
						});

						/* 上色 */

						d3.csv("salary.csv", function(data) {
						
							/* 將各縣市的數值(parameter)寫入features裡面，寫法範例，可自行更改 */
							for(item=features.length - 1; item >= 0; item-- ) { 
								var site = features[item].properties.County_ID;
								var parameter = data[0][site];
								if(typeof parameter == 'undefined'){
									features[item].properties.parameter = Math.floor((Math.random() * 100) + 1);
								}else{
									features[item].properties.parameter = parameter;
								}	
							}
							/* 
								domain: 設定數值最低最高的範圍
								range: 設定最低最高的對應的顏色
							*/
							//var color = d3.scale.linear().domain([300,331]).range(["Yellow","red"]);
							var colormap = ['#81dae6','#51a7b2','#074c6d'];
							/* 利用D3c.js畫出svg，顏色依照features裡的parameter參數 */
							d3.select("svg").selectAll("path").data(features)
							.attr({
								d: path,
								fill: function(d) {
									if(d.properties.parameter < 307){return colormap[0];}
									else if(d.properties.parameter < 315){return colormap[1];}
									else{return colormap[2];}
									//return color(d.properties.parameter);
								},
								class: "area"
							}).on({
							/* 
								移入時，將選取到的地區(SVG PATH tag)加入css，計算滑鼠位置，將div#mouseIn座標設定到滑鼠位置
								移出時，將選取到的地區移除css，將div#mouseIn隱藏
							*/
								"mouseover": function(d){
									d3.select(this).classed("active", true);
									var x = d3.mouse(this)[0];
									var y = d3.mouse(this)[1];
									$('#mouseInf').css({ "top": event.clientY + "px", "left": event.clientX + "px" }).css("z-index","1").show("fast");
									$('#mouseInf').text(d.properties.C_Name+"\n"+Math.floor(d.properties.parameter/30)+"個月又"+(d.properties.parameter%30)+"天");
								},
								"mouseout":  function(){
									d3.select(this).classed("active", false);
									$('#mouseInf').hide();
								},
							})

						});
					});
					
			}
			
			function getParameterByName(name, url) {
				if (!url) url = window.location.href;
				name = name.replace(/[\[\]]/g, "\\$&");
				var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
					results = regex.exec(url);
				if (!results) return null;
				if (!results[2]) return '';
				return decodeURIComponent(results[2].replace(/\+/g, " "));
			}
			
		</script>
		
	</body>
</html>


